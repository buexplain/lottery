<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            background-color: rgba(237, 237, 237);
            font-family: PingFangSC-Regular, PingFang SC;
        }

        #j-message {
            text-align: center;
            font-size: 4.26vw;
            padding: 2.66vw;
        }

        #j-tagContainer {
            position: fixed;
            left: 50%;
            top: 46%;
            transform: translate(-50%, -50%);
        }

        .tag {
            position: absolute;
            left: 0;
            top: 0;
            will-change: transform;
        }

        #j-lottery {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
        }

        #j-lottery img {
            display: none;
            padding: 2.66vw;
            width: 20.6vw;
            height: 20.6vw;
            filter: grayscale(50%);
        }

        #j-lottery .shake {
            animation: lotteryShake 1000ms ease-in-out;
        }

        @keyframes lotteryShake {
            10%, 90% {
                transform: translate3d(0, -0.26vw, 0);
            }
            20%, 80% {
                transform: translate3d(0, 0.53vw, 0);
            }
            30%, 70% {
                transform: translate3d(0, -1.06vw, 0);
            }
            40%, 60% {
                transform: translate3d(0, 1.06vw, 0);
            }
            50% {
                transform: translate3d(0, -1.06vw, 0);
            }
        }
    </style>
    <title id="j-title">幸运七彩球</title>
</head>
<body>
<div id="j-message">&nbsp;</div>
<div id="j-tagContainer"></div>
<div id="j-lottery">
    <img src="data:image/png;base64,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"
         onclick="lotteryObj.run()">
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
<script>
    const wsAddr = '{!.conn!}';
    const limit3D = parseInt('{!.limit3D!}');
    const workerId = '{!.workerId!}';
    let messageObj = {
        _obj: null,
        _init: function () {
            if (!messageObj._obj) {
                messageObj._obj = document.querySelector("#j-message");
            }
        },
        error: function (message) {
            messageObj._init();
            messageObj._obj.innerHTML = message;
            messageObj._obj.style.color = "#ef0634";
        },
        success: function (message) {
            messageObj._init();
            messageObj._obj.innerHTML = message;
            messageObj._obj.style.color = "#000000";
        }
    };
    let thirdBrother = {
        _container: null,
        setContainer: function (container) {
            this._container = container;
        },
        setRadius: function () {
            this._radius = parseInt((document.documentElement.clientWidth / 2).toFixed(0)) - parseInt((parseInt((document.documentElement.clientWidth / 2).toFixed(0)) / 10).toFixed(0));
            this._cos = Math.cos(Math.PI / this._radius);
            this._sin = Math.sin(Math.PI / this._radius);
        },
        _cos: Math.cos(Math.PI / 300),
        _sin: Math.sin(Math.PI / 300),
        _radius: 300,
        _animateIndex: 0,
        _animateFastIndex: 0,
        _tags: [],
        _rgb: [
            '#9400fc',
            '#02418d',
            '#0099f6',
            '#44EA00',
            '#eac331',
            '#cb7705',
            '#ef0634',
        ],
        countTag: function () {
            let tagEle = document.querySelectorAll(".tag");
            if (tagEle) {
                return tagEle.length;
            }
            return 0;
        },
        clearTag: function () {
            let tagEle = document.querySelectorAll(".tag");
            if (tagEle) {
                for (let i = 0; i < tagEle.length; i++) {
                    tagEle[i].remove();
                }
            }
        },
        addTag: function (id, num) {
            if (document.querySelector("#j-" + id)) {
                return;
            }
            let ele = document.createElement('span');
            ele.innerText = num;
            ele.id = "j-" + id;
            ele.className = "tag";
            ele.style.color = this._rgb[num % this._rgb.length];
            if (wsObj.currentUser && id === wsObj.currentUser.uniqId) {
                ele.style.fontSize = '11.2vw';
                ele.style.fontWeight = '600';
                ele.style.textShadow = '0 0 2.66vw ' + ele.style.color;
            } else {
                ele.style.fontSize = '7.46vw';
            }
            this._container.append(ele);
        },
        removeTag: function (id) {
            let tmp = document.querySelector("#j-" + id);
            if (tmp) {
                tmp.remove();
            }
        },
        move: function () {
            for (let i = 0; i < thirdBrother._tags.length; i++) {
                let ele = thirdBrother._tags[i];
                let y1 = ele.y * thirdBrother._cos - ele.z * thirdBrother._sin;
                let z1 = ele.z * thirdBrother._cos + ele.y * thirdBrother._sin;
                ele.y = y1;
                ele.z = z1;

                let x1 = ele.x * thirdBrother._cos - ele.z * thirdBrother._sin;
                let z2 = ele.z * thirdBrother._cos + ele.x * thirdBrother._sin;
                ele.x = x1;
                ele.z = z2;

                ele.move();
            }
        },
        animateStart: function () {
            thirdBrother.move();
            thirdBrother._animateIndex = requestAnimationFrame(thirdBrother.animateStart);
        },
        animateStop: function () {
            if (this._animateIndex > 0) {
                cancelAnimationFrame(this._animateIndex);
                this._animateIndex = 0;
            }
        },
        animateFastStart: function () {
            this._cos = Math.cos(Math.PI / (this._radius / 5));
            this._sin = Math.sin(Math.PI / (this._radius / 5));
        },
        animateFastStop: function () {
            this._cos = Math.cos(Math.PI / this._radius);
            this._sin = Math.sin(Math.PI / this._radius);
        },
        reset: function () {
            let tag = function (ele, x, y, z) {
                this.ele = ele;
                this.x = x;
                this.y = y;
                this.z = z;
            }
            tag.prototype = {
                move: function () {
                    let scale = document.documentElement.clientWidth / (document.documentElement.clientWidth - this.z);
                    let alpha = (this.z + thirdBrother._radius) / (2 * thirdBrother._radius);
                    let left = this.x + thirdBrother._container.offsetWidth / 2 - this.ele.offsetWidth / 2 + "px";
                    let top = this.y + thirdBrother._container.offsetHeight / 2 - this.ele.offsetHeight / 2 + "px";
                    let transform = 'translate(' + left + ', ' + top + ') scale(' + scale + ')';
                    this.ele.style.opacity = (alpha + 0.5).toFixed(2);
                    this.ele.style.zIndex = (scale * 100).toFixed(0);
                    this.ele.style.transform = transform;
                }
            }
            let tagEle = document.querySelectorAll(".tag");
            this._tags = [];
            for (let i = 0; i < tagEle.length; i++) {
                let ele = tagEle[i];
                let k = -1 + (2 * (i + 1) - 1) / tagEle.length;
                let a = Math.acos(k);
                let b = a * Math.sqrt(tagEle.length * Math.PI);
                let x = this._radius * Math.sin(a) * Math.cos(b);
                let y = this._radius * Math.sin(a) * Math.sin(b);
                let z = this._radius * Math.cos(a);
                let t = new tag(ele, x, y, z);
                this._tags.push(t);
                t.move();
            }
        },
    };
    let wsObj = {
        currentUser: null,
        currentUserList: new Map(),
        onlineNum: 0,
        callback: new Map(),
        _socket: null,
        _heartbeatInterval: 0,
        showOnline: function () {
            try {
                messageObj.success("我的号码：<strong>" + wsObj.currentUser.id + "</strong>，参与人数：" + wsObj.onlineNum);
            } catch (e) {
            }
        },
        connect: function (secretKey) {
            try {
                wsObj.close();
                let url = wsAddr;
                let protocols = null;
                if (secretKey !== '' && secretKey !== undefined && secretKey !== null) {
                    url += '?connType=admin';
                    let time = parseInt(((new Date()).getTime() / 1000).toFixed(0));
                    let randStr = Math.random().toString(36).slice(-8);
                    let md5Str = md5(time + randStr + secretKey);
                    protocols = [md5Str, time, randStr];
                }
                //时间戳+随机值+服务器key
                let tmp = new WebSocket(url, protocols);
                if (!tmp) {
                    return;
                }
                tmp.onerror = wsObj.onerror;
                tmp.onopen = wsObj.onopen;
                tmp.onmessage = wsObj.onmessage;
                tmp.onclose = wsObj.onclose;
                wsObj._socket = tmp;
            } catch (e) {
                console.error(e);
            }
        },
        send: function (cmd, data) {
            if (!wsObj._socket) {
                return;
            }
            if (!data) {
                data = {};
            }
            //这里写死workerId
            wsObj._socket.send(workerId + JSON.stringify({
                cmd: cmd,
                data: JSON.stringify(data)
            }));
        },
        close: function () {
            wsObj._socket && wsObj._socket.close();
        },
        onerror: function () {
            if (wsObj._heartbeatInterval > 0) {
                clearInterval(wsObj._heartbeatInterval);
                wsObj._heartbeatInterval = 0;
            }
            wsObj._socket = null;
        },
        onopen: function () {
            if (wsObj._heartbeatInterval > 0) {
                clearInterval(wsObj._heartbeatInterval);
                wsObj._heartbeatInterval = 0;
            }
            wsObj._heartbeatInterval = setInterval(function () {
                wsObj._socket && wsObj._socket.send("~3yPvmnz~");
            }, 1000 * 28);
        },
        onclose: function () {
            if (wsObj._heartbeatInterval > 0) {
                clearInterval(wsObj._heartbeatInterval);
                wsObj._heartbeatInterval = 0;
            }
            wsObj._socket = null;
            thirdBrother.animateStop();
            thirdBrother.clearTag();
            messageObj.error('&nbsp;');
            alert('失去抽奖资格啦，赶紧刷新页面进来！');
        },
        onmessage: function (evt) {
            if (!evt.data) {
                console.error(evt.data);
                return;
            }
            if (evt.data === '~u38NvZ~') {
                return;
            }
            /**
             *
             * @type {{cmd: number, version: number, data:any}}
             */
            let ret = JSON.parse(evt.data);
            let cb = wsObj.callback.get(ret.cmd);
            if (cb) {
                cb(ret);
            } else {
                console.log(ret);
            }
        }
    };
    let versionObj = {
        _m: new Map(),
        check: function (currentCmd, version, otherCmdArr) {
            if (otherCmdArr === undefined) {
                otherCmdArr = [currentCmd];
            } else {
                otherCmdArr.push(currentCmd);
            }
            let tmp = [];
            otherCmdArr.forEach(function (cmd) {
                if (versionObj._m.has(cmd)) {
                    tmp.push(versionObj._m.get(cmd));
                }
            });
            tmp.push(version);
            if (Math.max(...tmp) === version) {
                versionObj._m.set(currentCmd, version);
                return true;
            }
            return false;
        },
    };
    let api = {
        ConnOpen: 1,
        ConnOpenBroadcast: 2,
        ConnCloseBroadcast: 3,
        LotteryStart: 4,
        LotteryEnd: 5,
        LotteryReset: 6
    };
    wsObj.callback.set(api.ConnOpen, function (resp) {
        if (resp.data.code !== 0) {
            messageObj.error(resp.data.message);
            return;
        }
        //记录当前的用户信息、当前的用户列表
        wsObj.currentUser = resp.data.data.user;
        wsObj.currentUserList = new Map();
        wsObj.onlineNum = resp.data.data.onlineNum;
        resp.data.data.userList.forEach(function (user) {
            wsObj.currentUserList.set(user.uniqId, user.id);
        });
        //渲染3d球
        thirdBrother.animateStop();
        thirdBrother.clearTag();
        wsObj.currentUserList.forEach(function (id, uniqId) {
            thirdBrother.addTag(uniqId, id);
        });
        thirdBrother.reset();
        thirdBrother.animateStart();
        //渲染在线人数
        wsObj.showOnline();
        //显示抽奖按钮
        if (wsObj.currentUser.isAdmin) {
            lotteryObj.showBtn();
        }
    });
    wsObj.callback.set(api.ConnOpenBroadcast, function (resp) {
        if (resp.data.code !== 0) {
            messageObj.error(resp.data.message);
            return;
        }
        //忽略自己的上线广播
        if (wsObj.currentUser && resp.data.data.uniqId === wsObj.currentUser.uniqId) {
            return;
        }
        //在线人数自增
        wsObj.onlineNum += 1;
        //如果不存在，并且当前的3d球渲染tag数比较少，则进行登记操作
        if (!wsObj.currentUserList.has(resp.data.data.uniqId) && thirdBrother.countTag() < limit3D) {
            //记录到当前用户列表
            wsObj.currentUserList.set(resp.data.data.uniqId, resp.data.data.id);
            //渲染3d球
            thirdBrother.animateStop();
            thirdBrother.addTag(resp.data.data.uniqId, resp.data.data.id);
            thirdBrother.reset();
            thirdBrother.animateStart();
        }
        //渲染在线人数
        wsObj.showOnline();
    });
    wsObj.callback.set(api.ConnCloseBroadcast, function (resp) {
        if (resp.data.code !== 0) {
            messageObj.error(resp.data.message);
            return;
        }
        //自减在线人数
        wsObj.onlineNum -= 1;
        if (wsObj.onlineNum < 0) {
            wsObj.onlineNum = 0;
        }
        //如果存在，则进行移除操作
        if (wsObj.currentUserList.has(resp.data.data.uniqId)) {
            //当前用户列表移除掉
            wsObj.currentUserList.delete(resp.data.data.uniqId);
            //渲染3d球
            thirdBrother.animateStop();
            thirdBrother.removeTag(resp.data.data.uniqId);
            thirdBrother.reset();
            thirdBrother.animateStart();
        }
        //渲染在线人数
        wsObj.showOnline();
    });
    wsObj.callback.set(api.LotteryStart, function (resp) {
        if (resp.data.code !== 0) {
            messageObj.error(resp.data.message);
            return;
        }
        //检查服务器给出的最新的状态
        if (!versionObj.check(resp.cmd, resp.version, [api.LotteryEnd, api.LotteryReset])) {
            return;
        }
        //设置抽奖按钮状态
        lotteryObj.setRunning();
        //提高3d球的运转速度
        thirdBrother.animateFastStart();
    });
    wsObj.callback.set(api.LotteryEnd, function (resp) {
        if (resp.data.code !== 0) {
            messageObj.error(resp.data.message);
            return;
        }
        //检查服务器给出的最新的状态，因为网络原因，可能导致抽奖的状态是错乱到达的
        if (!versionObj.check(resp.cmd, resp.version, [api.LotteryStart, api.LotteryReset])) {
            return;
        }
        //设置抽奖按钮状态
        lotteryObj.setRunOk();
        //恢复3d球的运转速度
        thirdBrother.animateFastStop();
        //显示中奖人
        if (resp.data.data.winner.id === wsObj.currentUser.id) {
            messageObj.success("<strong>我中奖啦</strong>");
        } else {
            messageObj.success("<strong>恭喜号码：" + resp.data.data.winner.id + "，中奖！</strong>");
        }
    });
    let lotteryObj = {
        _obj: null,
        _init: function () {
            if (!lotteryObj._obj) {
                lotteryObj._obj = document.querySelector("#j-lottery").querySelector('img');
            }
        },
        hideBtn: function () {
            lotteryObj._init();
            lotteryObj._obj.style.display = 'none';
        },
        showBtn: function () {
            lotteryObj._init();
            lotteryObj._obj.style.display = 'inline-block';
        },
        setRunning: function () {
            lotteryObj._init();
            lotteryObj._obj.style.filter = 'grayscale(0%)';
            lotteryObj._obj.setAttribute('data-lock', 'true');
            //显示在线人数
            wsObj.showOnline();
        },
        setRunOk: function () {
            lotteryObj._init();
            lotteryObj._obj.style.filter = 'grayscale(50%)';
            lotteryObj._obj.setAttribute('data-lock', 'false');
        },
        _lockShake: 0,
        run: function () {
            let t = (new Date()).getTime();
            //锁定一会儿，让服务器将操作广播给其它用户，其它用户的状态变更后，再进行下一次操作，
            if (lotteryObj._lockShake + 1000 * 3 > t) {
                return;
            }
            lotteryObj._lockShake = t;
            lotteryObj._init();
            //添加抖动动画，避免用户认为没点击中
            lotteryObj._obj.className = "shake";
            //一秒后取消抖动
            setTimeout(function () {
                lotteryObj._obj.className = "";
            }, 1000);
            if (lotteryObj._obj.getAttribute('data-lock') === 'true') {
                wsObj.send(api.LotteryEnd);
            } else {
                wsObj.send(api.LotteryStart);
            }
        }
    };
    window.onload = function () {
        (function () {
            // 缩放
            try {
                // 禁用双击缩放
                document.addEventListener("touchstart", function (event) {
                    if (event.touches.length > 1) {
                        event.preventDefault();
                    }
                });
                let lastTouchEnd = 0;
                document.addEventListener(
                    "touchend",
                    function (event) {
                        let now = (new Date()).getTime();
                        if (now - lastTouchEnd <= 300) {
                            event.preventDefault();
                        }
                        lastTouchEnd = now;
                    },
                    false
                );
                // 禁用双指手势操作
                document.addEventListener("gesturestart", function (event) {
                    event.preventDefault();
                });
            } catch (error) {
            }
        })();
        //初始化3d球容器
        thirdBrother.setContainer(document.querySelector("#j-tagContainer"));
        thirdBrother.setRadius();
        //发起连接
        let connType = (new URLSearchParams(window.location.search)).get("connType");
        lotteryObj.hideBtn();
        if (connType === "admin") {
            let secretKey = prompt("请输入密码", "");
            if (secretKey != null) {
                wsObj.connect(secretKey);
            }
        } else {
            wsObj.connect();
        }
    }
</script>
</body>
</html>